<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>House Rotation Tool for Stellar Astrology</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      padding: 20px;
      max-width: 1100px;
      margin: 0 auto;
    }

    h1 {
      margin-bottom: 14px;
      font-size: 22px;
      font-weight: 700;
    }

    select, input {
      padding: 8px;
      font-size: 16px;          /* â¬… same visual weight as output */
      font-weight: 700;         /* â¬… bold like output */
      background: #0f172a;
      color: #e5e7eb;
      border: 1px solid #334155;
      border-radius: 6px;
      width: 100%;
    }

    #rotation {
      background: #1e293b;
      color: #facc15;
      font-weight: 700;
      border: 1px solid #facc15;
      width: auto;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
      background: #020617;
      border-radius: 8px;
      overflow: hidden;
      table-layout: fixed;
    }

    th, td {
      border: 1px solid #334155;
      padding: 8px;
      text-align: left;
      font-weight: 600;
    }

    th {
      background: #1e293b;
      color: #f8fafc;
    }

    /* ðŸ”¹ STRONG VISUAL SEPARATION BETWEEN VALUES & NOTES */
    #inputTable td:nth-child(2),
    #inputTable th:nth-child(2) {
      border-right: 3px solid #64748b;
    }

    .container {
      display: grid;
      grid-template-columns: 3fr 2fr;
      gap: 28px;
      margin-top: 20px;
      align-items: start;
    }

    .table1-wrap {
      width: 600px;
      border: 1px solid #475569;
      border-radius: 10px;
      padding: 6px;
    }

    .table2-wrap {
      width: 400px;
      border: 1px solid #475569;
      border-radius: 10px;
      padding: 6px;
    }

    .container.stacked .table2-wrap {
      grid-column: 1;
      grid-row: 2;
    }

    button {
      padding: 6px 10px;
      font-weight: 700;
      background: #1e293b;
      color: #e5e7eb;
      border: 1px solid #334155;
      border-radius: 6px;
      cursor: pointer;
      margin-left: 8px;
    }

    .note {
      font-size: 12px;
      color: #94a3b8;
      margin-top: 6px;
    }

    .controls {
      margin-top: 10px;
      display: none;
    }
  </style>
</head>

<body>

<h1>House Rotation Tool for Stellar Astrology</h1>

<label><b>Rotation:</b></label>
<select id="rotation"></select>

<button id="clearBtn">Clear All</button>
<button id="toggleLayoutBtn">Toggle Table Layout</button>
<button id="saveBtn">Save Chart</button>
<button id="loadBtn">Load Chart</button>
<button id="exportJpgBtn">Export JPG</button>
<button id="sortBtn">Sorting : ON</button>

<div class="controls">
  <label>
    <input type="checkbox" id="sortToggle" checked>
    Sort rotated values
  </label>
</div>

<input type="file" id="fileInput" accept=".json" style="display:none">

<div class="container" id="captureArea">

  <!-- TABLE 1 -->
  <div class="table1-wrap">
    <table>
      <colgroup>
        <col style="width:150px">
        <col style="width:300px">
        <col style="width:120px">
      </colgroup>
      <thead>
        <tr>
          <th>Planet</th>
          <th>Values</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody id="inputTable"></tbody>
    </table>
    <div class="note">
      Any symbols allowed as separator ( , . - / | etc ). Only numbers 1â€“12 are considered.
    </div>
  </div>

  <!-- TABLE 2 -->
  <div class="table2-wrap">
    <table>
      <colgroup>
        <col style="width:150px">
        <col style="width:250px">
      </colgroup>
      <thead>
        <tr>
          <th>Planet</th>
          <th>Rotated Values</th>
        </tr>
      </thead>
      <tbody id="outputTable"></tbody>
    </table>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
  const planets = [
    "Surya","Chandra","Mangala","Rahu",
    "Jupiter","Saturn","Budha","Ketu","Venus"
  ];

  const inputTable = document.getElementById("inputTable");
  const outputTable = document.getElementById("outputTable");
  const rotationSelect = document.getElementById("rotation");
  const sortToggle = document.getElementById("sortToggle");
  const sortBtn = document.getElementById("sortBtn");

  let doSort = true;

  for (let i = 1; i <= 12; i++) {
    rotationSelect.innerHTML += `<option value="${i}">${i}</option>`;
  }

  planets.forEach(p => {
    inputTable.innerHTML += `
      <tr>
        <td>${p}</td>
        <td><input type="text" data-planet="${p}"></td>
        <td><input type="text" data-note="${p}"></td>
      </tr>`;
    outputTable.innerHTML += `
      <tr>
        <td>${p}</td>
        <td id="out-${p}"></td>
      </tr>`;
  });

  function rotateValue(value, rotation) {
    let shifted = value + (rotation - 1);
    if (shifted > 12) shifted -= 12;
    return shifted;
  }

  function extractNumbers(str) {
    const matches = str.match(/\d+/g) || [];
    return matches.map(n => Number(n)).filter(n => n >= 1 && n <= 12);
  }

  function updateOutput() {
    const rotation = +rotationSelect.value;

    planets.forEach(p => {
      const input = document.querySelector(`[data-planet='${p}']`).value;
      const out = document.getElementById(`out-${p}`);

      if (!input.trim()) {
        out.textContent = "";
        return;
      }

      const nums = extractNumbers(input);
      if (!nums.length) {
        out.textContent = "";
        return;
      }

      let result = rotation === 1
        ? [...nums]
        : nums.map(n => rotateValue(n, rotation));

      if (doSort) result.sort((a, b) => a - b);

      out.textContent = result.join(", ");
    });
  }

  rotationSelect.onchange = updateOutput;
  inputTable.oninput = updateOutput;
  sortToggle.onchange = updateOutput;

  sortBtn.onclick = () => {
    doSort = !doSort;
    sortToggle.checked = doSort;
    sortBtn.textContent = `Sorting : ${doSort ? "ON" : "OFF"}`;
    updateOutput();
  };

  clearBtn.onclick = () => {
    const ok = confirm(
      "âš ï¸ Are you sure you want to clear the entire chart?\n\nThis action cannot be undone."
    );
    if (!ok) return;

    document.querySelectorAll("#inputTable input").forEach(i => i.value = "");
    document.querySelectorAll("[id^='out-']").forEach(o => o.textContent = "");
  };

  toggleLayoutBtn.onclick = () => {
    document.querySelector(".container").classList.toggle("stacked");
  };

  saveBtn.onclick = () => {
    const data = { rotation: rotationSelect.value, planets: {} };
    planets.forEach(p => {
      data.planets[p] = {
        values: document.querySelector(`[data-planet='${p}']`).value,
        note: document.querySelector(`[data-note='${p}']`).value
      };
    });

    const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "chart.json";
    a.click();
  };

  loadBtn.onclick = () => fileInput.click();

  fileInput.onchange = e => {
    const reader = new FileReader();
    reader.onload = () => {
      const data = JSON.parse(reader.result);
      rotationSelect.value = data.rotation;
      planets.forEach(p => {
        document.querySelector(`[data-planet='${p}']`).value = data.planets[p]?.values || "";
        document.querySelector(`[data-note='${p}']`).value = data.planets[p]?.note || "";
      });
      updateOutput();
    };
    reader.readAsText(e.target.files[0]);
  };

  exportJpgBtn.onclick = () => {
    html2canvas(document.getElementById("captureArea"), {
      backgroundColor: "#0f172a",
      scale: 2
    }).then(canvas => {
      const link = document.createElement("a");
      link.download = "house-rotation-chart.jpg";
      link.href = canvas.toDataURL("image/jpeg", 0.95);
      link.click();
    });
  };
</script>

</body>
</html>
